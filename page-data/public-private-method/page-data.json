{"componentChunkName":"component---src-templates-post-template-tsx","path":"/public-private-method/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>개요</h2>\n<p>private 접근 제어자로 선언된 배열 또는 컬렉션 타입 필드의 객체를 private 메소드를 통해 그대로 반환하지 않도록 해야 한다.</p>\n<p>필요한 경우 복사본을 생성하여 반환하거나, 접근 및 수정을 제어하는 별도의 public 메소드를 선언하여 사용해야 한다.\r\n이렇게 함으로써 외부에서 조작하는 것을 방지할 수 있다.</p>\n<h2>어떻게 대비할 수 있는지 알아보자</h2>\n<h3>취약점 존재 예시</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DangerousPrivateArray</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> fruits<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">getFruits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fruits<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">DangerousPrivateArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fruits <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"grape\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"apple\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"banana\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"orange\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"strawberry\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">DangerousPrivateArray</span> innerData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DangerousPrivateArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> outerData <span class=\"token operator\">=</span> innerData<span class=\"token punctuation\">.</span><span class=\"token function\">getFruits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        outerData<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"watermelon\"</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이, DangerousPrivateArray 클래스의 필드 변수가 private으로 선언되어 있어 외부로의 접근을 막을 수 있겠다 생각할 수 있지만, 그렇지 않다.\r\n<code class=\"language-text\">getFruits()</code> 메소드를 통해 fruits 객체의 주소를 그대로 반환하고 있다. 이렇게 하면 main 메소드에서 선언한 innerData객체로 클래스 안에 있던 fruits 객체를 그대로 꺼낼 수가 있다.\r\n그 객체 주소를 다른 새 객체에 복사하면 그 새 객체에서도 private 접근제어자로 선언한 fruits 객체의 내용을 바꿀 수 있게 된다.</p>\n<p>그러면 어떻게 상태의 일관성을 망치지 않을 수 있을까?</p>\n<h3>취약점 해결 방법</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProtectPrivateArrayByPublicMethod</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> fruits<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token function\">getFruits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> safeArray <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fruits<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> safeArray<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            safeArray<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> fruits<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token keyword\">return</span> safeArray<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">ProtectPrivateArrayByPublicMethod</span> innerData <span class=\"token operator\">=</span> <span class=\"token class-name\">ProtectPrivateArrayByPublicMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> outerData <span class=\"token operator\">=</span> innerData<span class=\"token punctuation\">.</span><span class=\"token function\">getFruits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        outerData<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"watermelon\"</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>바로 새 배열, 즉 <strong>값만 복사한 뒤 새 객체 안에</strong> 채운다.\r\n그러면 <code class=\"language-text\">outerData</code>의 3번째 인덱스 값만 watermelon으로 바뀌고, 원본 private 배열에는 영향이 없게 되어 캡슐화를 지킬 수 있게 된다. 즉, 상태의 일관성을 지킬 수 있게 된다.</p>\n<h2>꼬리에 꼬리를 무는 궁금증</h2>\n<h3>Q. String의 배열 요소는 참조형 클래스인 String일텐데, 참조주소를 넘기는 게 아닌가요?</h3>\n<p>그렇다. 참조주소를 넘기는 건 맞다. 하지만, String은 <strong>불변 객체</strong>이기 때문에 참조 주소를 공유해도 내부 상태가 바뀌지 않는다.</p>\n<p>그러므로 위의 취약점 해결 방법으로 방어적 복사를 하여 상태의 일관성을 지킬 수 있다.</p>\n<p>그러나 배열 요소 객체의 변경 가능성이 있다면(가변 객체라면) 얘기가 달라진다.</p>\n<p>그때는 새 배열 safeArray 안의 요소를 통해 객체 상태를 바꿀 수 있고, 그 객체를 참조하는 원본 배열에서도 변경이 가능하게 된다.</p>\n<p>이런 경우에는 배열 구조는 보호되지만, 요소의 상태는 노출되는 것이다.\r\n이때는 깊은 복사 또는 불변 뷰/래퍼까지 고려해야 한다.</p>\n<h3>Q. 불변 뷰/래퍼 예시도 들어주세요.</h3>\n<p>불변 뷰/래퍼는 <strong>외부에서 수정만 못 하게 막거나 읽기 전용으로만 노출</strong>하고 싶을 때 활용할 수 있다.</p>\n<h4>얕은 복사만 하는 경우의 문제 상황</h4>\n<p>먼저, 가변 객체에 대해 얕은 복사만 한 경우를 예시로 들겠다.\r\n가변 객체(도메인 클래스)를 선언하면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Address</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> city<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> street<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> city<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> street<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>city <span class=\"token operator\">=</span> city<span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>street <span class=\"token operator\">=</span> street<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token comment\">// setter가 있으므로 가변 객체가 됨</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setCity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> city<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>city <span class=\"token operator\">=</span> city<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setStreet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> street<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>street <span class=\"token operator\">=</span> street<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token annotation punctuation\">@Override</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> city <span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> street<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">getAddresses()</code>를 통해 내부 리스트를 그대로 반환하게 되어 변경에 노출된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserInfo</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> addresses <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        addresses<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Seoul\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Gangnam-daero\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        addresses<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Busan\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Haeundae-ro\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAddresses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> addresses<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 내부 객체를 직접 수정하고 내부 리스트 구조까지 변경할 수 있게 되어 캡슐화가 깨지게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">UserInfo</span> info <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> outer <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span><span class=\"token function\">getAddresses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setCity</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HackedCity\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 내부 객체 직접 수정</span>\r\nouter<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 내부 리스트 구조까지 변경 가능</span></code></pre></div>\n<p>이를 UserInfo쪽에서 불변 뷰(Unmodifiable Wrapper)로 가변 객체를 방어할 수 있다. 즉, 읽기 전용 뷰로 감싸는 게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserInfo</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> addresses <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        addresses<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Seoul\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Gangnam-daero\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        addresses<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Busan\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Haeundae-ro\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAddresses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Collections</span><span class=\"token punctuation\">.</span><span class=\"token function\">unmodifiableList</span><span class=\"token punctuation\">(</span>addresses<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">UserInfo</span> info <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> outer <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span><span class=\"token function\">getAddresses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\nouter<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// UnsupportedOperationException 발생</span>\r\nouter<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"X\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Y\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// UnsupportedOperationException 발생</span></code></pre></div>\n<p>그러나 이렇게 구조 보호를 할 수는 있지만</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">outer<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setCity</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HackedCity\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>요소는 여전히 가변이라 접근이 가능하다.\r\n즉, unmodifiableList는 <strong>리스트 구조만 막을 수 있고 요소 객체까지 불변으로 만들어주진 못한다.</strong></p>\n<h3>Q. 그러면 요소까지 방어할 수 있는 방법이 있을까요?</h3>\n<blockquote>\n<p>이전까지만 해도 public 메소드에 의해 반환된 private 컬렉션(배열)에 대한 시큐어 코딩은 충분하다. 왜냐하면 위의 요점은 <strong>내부 배열 직접 노출하는 것을 막기</strong>이지, 지금부터 하는 것은 시큐어 코딩을 넘어서서 추가적인 궁금증에 대한 학습을 기록으로 남긴 것이다.</p>\n</blockquote>\n<p>요소까지 방어하고 싶다면 깊은 복사를 활용할 수 있다.\r\n깊은 복사만 활용하거나, 아니면 깊은 복사 + 불변 뷰까지 섞어서 활용할 수 있다.</p>\n<h4>1. 깊은 복사 예시</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">/**\r\n * Copy Constructor를 둔 가변 클래스\r\n **/</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Address</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> city<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> street<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> city<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> street<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>city <span class=\"token operator\">=</span> city<span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>street <span class=\"token operator\">=</span> street<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Address</span> other<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>city <span class=\"token operator\">=</span> other<span class=\"token punctuation\">.</span>city<span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>street <span class=\"token operator\">=</span> other<span class=\"token punctuation\">.</span>street<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setCity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> city<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>city <span class=\"token operator\">=</span> city<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setStreet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> street<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>street <span class=\"token operator\">=</span> street<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token annotation punctuation\">@Override</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> city <span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> street<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserInfo</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> address <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        addresses<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Seoul\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Gangnam-daero\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        addresses<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Busan\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Haeundae-ro\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token comment\">// getter에서 깊은 복사 적용</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAddresses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> copy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>addresses<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Address</span> addr <span class=\"token operator\">:</span> addresses<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            copy<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token keyword\">return</span> copy<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">UserInfo</span> info <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> outer <span class=\"token operator\">=</span> info<span class=\"token punctuation\">.</span><span class=\"token function\">getAddresses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\nouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setCity</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HackedCity\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nouter<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>outer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>       <span class=\"token comment\">// 바뀐 건 복사본</span>\r\n<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span><span class=\"token function\">getAddresses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 원본은 그대로</span></code></pre></div>\n<p><strong>깊은 복사만 했을 때</strong>는 새 리스트로 구조를 보호할 수 있고, 요소 객체도 새 Address로 복제된다. 즉, 외부에서 수정할 때 내부에 영향을 안 미치는 deep copy가 된다.</p>\n<p>그러나 불변 뷰/래퍼 방식이나 얕은 복사에 비해 비용이 든다는 단점이 있다.</p>\n<h4>2. 깊은 복사 + 불변 뷰 섞은 예시</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n\r\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAddresses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> copy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>addresses<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Address</span> addr <span class=\"token operator\">:</span> addresses<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        copy<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Collections</span><span class=\"token punctuation\">.</span><span class=\"token function\">unmodifiableList</span><span class=\"token punctuation\">(</span>copy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>이렇게 한다면, 방금 전 깊은 복사만 했을 때와 같이 외부에서는 구조를 변경할 수 없고 요소도 모두 복제된 객체라 원본을 오염시킬 수 없게 된다.</p>\n<h3>Q. 깊은 복사만 했을 때와 깊은 복사와 불변 뷰까지 했을 때의 차이가 뭔가요?</h3>\n<p><code class=\"language-text\">unmodifiableList</code>를 사용하면서, 구조를 변경하려는 다른 사용자에게 읽기 전용이라고 코드 레벨에서 강제할 수 있다.\r\n즉, API를 사용할 때 실수나 오해까지 줄여줄 수 있다.</p>\n<h3>Q. 깊은 복사를 할 때의 비용은 어떤 비용을 말씀하시는 걸까요?</h3>\n<p>바로</p>\n<ol>\n<li>연산 비용</li>\n<li>메모리 사용량</li>\n<li>GC 부담</li>\n<li>코드 복잡도 (유지보수 비용)</li>\n</ol>\n<p>가 있겠다.</p>\n<p>다만, 유지보수 비용은 개인적으로 깊은 복사를 했다고 비용이 더 많이 든다고 생각하지는 않는다. 의도를 정확하게 전달하고 싶다면 되려 모호한 표현보다는 명확한 표현이 더 낫다고 생각한다.</p>\n<p>그러면 나머지 세 가지를 보자.</p>\n<h4>1. 연산 비용</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n\r\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAddresses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Address</span><span class=\"token punctuation\">></span></span> copy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>addresses<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Address</span> addr <span class=\"token operator\">:</span> addresses<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        copy<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span>addr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> copy<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>여기서 <code class=\"language-text\">copy.add(new Address(addr))</code> 로 인해 요소를 매번 새로 생성한다.\r\n이때 드는 시간 비용을 시간복잡도로 표현하면 O(N)이 된다. 요소 개수가 n개일 때, O(n) 번의 생성과 대입 연산이 발생하기 때문이다.</p>\n<p>객체가 VO(Value Object)라면 값이 쌀 수는 있지만, 내부에 컬렉션, 검증 로직, 추가 연산이 있다면 복사하는 것 자체가 비용이 많이 들게 된다.\r\n<code class=\"language-text\">getAddresses()</code>를 한 번에 요청을 많이 한다면 그만큼 deep copy가 발생할 거고, 그에 따른 비용이 누적된다.\r\n그러므로, shallow copy(배열만 새로 만들고 요소 참조는 복사 가능)보다 deep copy(객체부터 요소까지 새로 생성)가 더 많은 CPU 연산 시간을 할애하게 된다.</p>\n<h4>2. Heap 메모리 비용</h4>\n<p>deep copy를 하면 동시에 더 많은 객체를 메모리에 올린다.</p>\n<p>예를 들어 원본 리스트에 Address가 10000개가 있을 때 매 요청마다 deep copy해서 반환한다면, 한 시점에 원본 10000개 + 복사본 10000개가 공존할 수 있게 된다.\r\n그만큼 추가 Heap 메모리를 사용하게 된다. 만약, 대량의 객체/리스트를 deep copy한다면 Heap 메모리에 대한 압박이 커질 거고, 생판 다른 요청들까지 합세하여 겹친다면 OOM으로도 이어질 수 있다.</p>\n<p>그에 반면, 얕은 복사는 새 배열/리스트만 추가로 하나 만들고 요소는 참조만 복사하므로 증가분이 훨씬 적다.</p>\n<h4>3. GC(Garbage Collection) 비용</h4>\n<p>deep copy를 하면 새 객체를 생성하게 되고, 사용한 뒤 금방 버려진다.\r\n그 결과로, GC 입장에서는 금방 죽는 객체들을 자주 치워야 해서 Minor GC 빈도가 증가하며, 이에 따라 Stop-the-world 시간이 조금씩 늘어나게 된다.</p>\n<p>요청이 많이 들어올 때, deep copy를 많이 반복하게 된다면 GC에 있어 병목이 발생할 수 있다.</p>\n<p>그에 비해 얕은 복사는 생성하는 객체 수가 훨씬 적어서 GC 부담도 상대적으로 적다.</p>\n<h3>Q. 불변 뷰 예시에서 나왔던 Collections.unmodifiableList()는 쓰다가 List의 기본 capacity를 벗어나면 어떻게 되나요?</h3>","frontmatter":{"title":"public 메소드에 의해 반환된 private 컬렉션(배열)이 왜 위험할까","summary":"sparrow 검사를 통해 분석하며 알아낸 인사이트","date":"2025.11.07.","categories":["보안"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAKABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAYJ/8QAFAEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB3pnrQAL/AP/EABgQAAMBAQAAAAAAAAAAAAAAAAIDBAUg/9oACAEBAAEFAqmUKBGle0uP/8QAFhEAAwAAAAAAAAAAAAAAAAAAEHHw/9oACAEDAQE/AZD/xAAbEQADAAIDAAAAAAAAAAAAAAABESEQMUFhcf/aAAgBAgEBPwFUlkviIeR3ZZPSx//EAB4QAAICAgIDAAAAAAAAAAAAAAECAxIEEQUhEyAi/9oACAEBAAY/AlbHgGQb/cfkEbUo/cZIKl70GnKrUsbAgAwh+B5HHWRlVnln4oiENrbyLHnvJRN90VpOjqP1/8QAGRAAAwADAAAAAAAAAAAAAAAAAREhACAx/9oACAEBAAE/IYD2sfgdNpbki7O9gjeASFlEKen/2gAMAwEAAgADAAAAEIQP/8QAGBEBAQEBAQAAAAAAAAAAAAAAAREhMRD/2gAIAQMBAT8QCK1bIMkEyA71q7yef//EABkRAQACAwAAAAAAAAAAAAAAAAEhQRARMf/aAAgBAgEBPxAQoiEXCAmokLLRGP/EABgQAQADAQAAAAAAAAAAAAAAAAEAESAh/9oACAEBAAE/EBgIvaYCXNu4aSqTh4V2iHnMXy//2Q=="},"images":{"fallback":{"src":"/static/b1aab721f75f7a71f9d959256b9f996d/c9779/sparrow.jpg","srcSet":"/static/b1aab721f75f7a71f9d959256b9f996d/100fb/sparrow.jpg 200w,\n/static/b1aab721f75f7a71f9d959256b9f996d/e8b57/sparrow.jpg 400w,\n/static/b1aab721f75f7a71f9d959256b9f996d/c9779/sparrow.jpg 800w","sizes":"(min-width: 800px) 800px, 100vw"},"sources":[{"srcSet":"/static/b1aab721f75f7a71f9d959256b9f996d/03437/sparrow.webp 200w,\n/static/b1aab721f75f7a71f9d959256b9f996d/9b881/sparrow.webp 400w,\n/static/b1aab721f75f7a71f9d959256b9f996d/c0ead/sparrow.webp 800w","type":"image/webp","sizes":"(min-width: 800px) 800px, 100vw"}]},"width":800,"height":400}},"publicURL":"/static/b1aab721f75f7a71f9d959256b9f996d/sparrow.jpg"}}}}]}},"pageContext":{"slug":"/public-private-method/"}},"staticQueryHashes":["3649515864","63159454"],"slicesMap":{}}